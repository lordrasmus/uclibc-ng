name: z_qemu_test_run

on:
  workflow_call:

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - name: Download a single artifact
        uses: actions/download-artifact@v3
        with:
          name: Qemu_Images
       # Use the output from the reusable workflow to upload the artifacts
      - name: Infos
        run: |
           jq '.' infos.json
      
      - name: parse Config JSON
        id: parse-json
        run: |
          json=$(cat infos.json)
          for key in $(echo "$json" | jq -r 'keys[]'); do
            value=$(echo "$json" | jq -r ".$key")
            echo "$key=$value" >> "$GITHUB_ENV"
          done
          
      - name: run Qemu
        run: |
           find .
           python3 .github/tools/run_qemu.py

      - name: upload 
        uses: actions/upload-artifact@master
        with:
          name: Test_Result
          path: |
             log.txt
